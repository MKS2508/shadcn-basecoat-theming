# 🛠️ Theme Manager CLI Specification

## Overview
CLI para automatizar la integración del `@mks2508/shadcn-basecoat-theme-manager` en proyectos Astro después de que Tailwind CSS v4 y Basecoat CSS ya estén instalados.

## 🔍 Prerequisites Verification

### 1. Project Detection
```bash
# Files that CLI checks for:
- astro.config.mjs || astro.config.js || astro.config.ts  # Astro project
- package.json                                           # Package manager detection
```

### 2. Dependencies Verification
```bash
# CLI checks package.json for:
- "tailwindcss": "^4.0.0"     # Required: Tailwind v4
- "basecoat-css": "*"         # Required: Basecoat CSS
- "@astrojs/tailwind": "*"    # Optional but recommended
```

### 3. Package Manager Detection
```bash
# CLI detects and uses appropriate PM:
- yarn.lock      → yarn add
- pnpm-lock.yaml → pnpm add  
- package-lock.json → npm install
```

## 📁 Directory Structure Creation

### CLI Creates These Directories
```
project/
├── public/
│   ├── src/themes/              ← CLI creates
│   └── themes/                  ← CLI creates
└── src/
    ├── components/              ← CLI creates if missing
    └── styles/                  ← Usually exists
```

## 📄 File Generation & Modification

### 1. New Files Generated by CLI

#### A. `/src/components/ThemeProvider.astro`
```astro
<!-- Auto-generated by @mks2508/theme-manager-cli -->
<script>
  import { ThemeCore } from '@mks2508/shadcn-basecoat-theme-manager';

  async function initializeThemeCore() {
    try {
      console.log('🎨 Initializing ThemeCore...');
      const themeCore = await ThemeCore.init();
      console.log('✅ ThemeCore initialized successfully');
    } catch (error) {
      console.error('❌ Failed to initialize ThemeCore:', error);
    }
  }

  initializeThemeCore();
</script>
```

#### B. `/public/themes/registry.json`
```json
{
  "version": "1.0.0",
  "themes": [
    {
      "id": "default",
      "name": "default",
      "label": "Default",
      "category": "built-in",
      "modes": {
        "light": "/src/themes/default-light.css",
        "dark": "/src/themes/default-dark.css"
      },
      "fonts": {
        "sans": "system-ui, sans-serif",
        "serif": "Georgia, serif",
        "mono": "ui-monospace, monospace"
      }
    }
  ]
}
```

#### C. `/public/src/themes/default-light.css`
```css
/* Auto-generated default light theme */
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --primary: 221.2 83.2% 53.3%;
  --secondary: 210 40% 96.1%;
  --accent: 210 40% 96.1%;
  --muted: 210 40% 96.1%;
  --destructive: 0 84.2% 60.2%;
  --border: 214.3 31.8% 91.4%;
  --input: 214.3 31.8% 91.4%;
  --ring: 221.2 83.2% 53.3%;
  --radius: 0.5rem;
}
```

#### D. `/public/src/themes/default-dark.css`
```css
/* Auto-generated default dark theme */
:root {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
  --primary: 217.2 91.2% 59.8%;
  --secondary: 217.2 32.6% 17.5%;
  --accent: 217.2 32.6% 17.5%;
  --muted: 217.2 32.6% 17.5%;
  --destructive: 0 62.8% 30.6%;
  --border: 217.2 32.6% 17.5%;
  --input: 217.2 32.6% 17.5%;
  --ring: 224.3 76.3% 94.1%;
  --radius: 0.5rem;
}
```

### 2. Files Modified by CLI

#### A. `package.json` (Dependency Addition)
```bash
# CLI adds:
npm install @mks2508/shadcn-basecoat-theme-manager
# or
pnpm add @mks2508/shadcn-basecoat-theme-manager
```

#### B. `src/styles/global.css` (Modification)
CLI adds these imports if missing:
```css
/* Added by @mks2508/theme-manager-cli */
@import "tailwindcss";
@import "basecoat-css";

/* Theme variable mapping for Tailwind v4 */
@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-primary: var(--primary);
  --color-secondary: var(--secondary);
  --color-accent: var(--accent);
  --color-muted: var(--muted);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
}

/* Existing user content preserved */
```

#### C. `src/layouts/Layout.astro` (Optional with --with-fouc flag)
CLI adds these modifications:
```astro
---
import '../styles/global.css'
/* Added by @mks2508/theme-manager-cli */
import ThemeProvider from '../components/ThemeProvider.astro'
---
<!doctype html>
<html lang="en">
  <head>
    <!-- Existing head content -->
    
    <!-- Added by CLI: FOUC Prevention -->
    <style>
      body {
        visibility: hidden;
        opacity: 0;
      }
    </style>
    
    <!-- Added by CLI: FOUC Script -->
    <script is:inline>
      // FOUC prevention script
      (function() {
        const savedTheme = localStorage.getItem('theme') || 'default';
        const savedMode = localStorage.getItem('theme-mode') || 'auto';
        
        const effectiveMode = savedMode === 'auto' 
          ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
          : savedMode;
        
        document.documentElement.classList.add(effectiveMode);
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        setTimeout(() => {
          document.body.style.visibility = 'visible';
          document.body.style.opacity = '1';
          document.body.style.transition = 'opacity 0.3s ease';
        }, 0);
      })();
    </script>
  </head>
  <body>
    <!-- Added by CLI -->
    <ThemeProvider />
    <!-- Existing body content -->
    <slot />
  </body>
</html>
```

## 🚀 CLI Commands Design

### Primary Command
```bash
npx @mks2508/theme-manager-cli init astro
```

### CLI Flags
```bash
--with-fouc        # Add FOUC prevention to Layout.astro
--theme-dir <dir>  # Custom theme directory (default: public/src/themes)
--no-examples      # Don't generate default theme examples
--check-only       # Only verify prerequisites without installing
--force            # Skip prerequisite checks
--verbose          # Detailed output
```

### Examples
```bash
# Basic setup
npx @mks2508/theme-manager-cli init astro

# Full setup with FOUC prevention
npx @mks2508/theme-manager-cli init astro --with-fouc

# Custom theme directory
npx @mks2508/theme-manager-cli init astro --theme-dir ./custom/themes

# Check prerequisites only
npx @mks2508/theme-manager-cli init astro --check-only
```

## ⚡ CLI Execution Flow

### 1. Prerequisites Check
```bash
✅ Checking Astro project...
✅ Checking Tailwind CSS v4...
✅ Checking Basecoat CSS...
✅ Detecting package manager...
```

### 2. Installation
```bash
📦 Installing @mks2508/shadcn-basecoat-theme-manager...
```

### 3. File Generation
```bash
📁 Creating theme directories...
📄 Generating ThemeProvider.astro...
📋 Creating themes registry...
🎨 Generating default theme files...
```

### 4. File Modification
```bash
⚙️ Updating global.css...
🔧 Updating Layout.astro... (if --with-fouc)
```

### 5. Completion
```bash
✅ Theme manager setup complete!

Next steps:
1. Start your dev server: npm run dev
2. Your themes are available in the UI
3. Add theme selector components as needed

📚 Documentation: https://docs.your-domain.com/theme-manager
```

## 🔧 Error Handling

### Common Errors
```bash
❌ Astro project not detected
   → Make sure astro.config.mjs exists

❌ Tailwind CSS v4 not found
   → Install Tailwind CSS v4 first: npm install tailwindcss@beta

❌ Basecoat CSS not found
   → Install Basecoat CSS first: npm install basecoat-css

❌ Theme files already exist
   → Use --force to overwrite or backup existing files
```

## 📊 CLI Success Criteria

1. ✅ All prerequisites verified
2. ✅ Package installed successfully
3. ✅ All files generated without conflicts
4. ✅ Existing files safely modified
5. ✅ No breaking changes to user's project
6. ✅ Theme system functional after setup